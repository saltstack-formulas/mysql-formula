# vim: set ft=yaml:
mysql:
  global:
    client-server:
      default_character_set: utf8

  clients:
    mysql:
      default_character_set: utf8
    mysqldump:
      default_character_set: utf8

  library:
    client:
      default_character_set: utf8

  server:
    # Use this account for database admin (defaults to root)
    root_user: 'admin'
    # root_password: '' - to have root@localhost without password
    root_password: 'somepass'
    root_password_hash: '*13883BDDBE566ECECC0501CDE9B293303116521A'
    user: mysql
    # If you only manage the dbs and users and the server is on
    # another host
    host: 123.123.123.123
    # my.cnf sections changes
    mysqld:
      # you can use either underscore or hyphen in param names
      bind-address: 0.0.0.0
      log_bin: /var/log/mysql/mysql-bin.log
      port: 3307
      binlog_do_db: foo
      auto_increment_increment: 5
    mysql:
      # my.cnf param that not require value
      no-auto-rehash: noarg_present

  salt_user:
    salt_user_name: 'salt'
    salt_user_password: 'someotherpass'
    grants:
      - 'all privileges'

  # Manage databases
  database:
    - foo
    - bar
  schema:
    foo:
      load: True
      source: salt://mysql/files/foo.schema
    bar:
      load: False
    baz:
      load: True
      source: salt://mysql/files/baz.schema.tmpl
      template: jinja

  # Manage users
  # you can get pillar for existing server using scripts/import_users.py script
  user:
    frank:
      password: 'somepass'
      # frank is allowed to connect from multiple remote host, thus producing
      # multiple mysql's users in the mysql.user table (hosts plural)
      hosts:
        - localhost
        - 10.0.0.22
      databases:
        - database: foo
          grants: ['select', 'insert', 'update']
        - database: bar
          grants: ['all privileges']
    bob:
      password_hash: '*6C8989366EAF75BB670AD8EA7A7FC1176A95CEF4'
      host: localhost
      databases:
        - database: foo
          grants: ['all privileges']
          grant_option: True
        - database: bar
          table: foobar
          grants: ['select', 'insert', 'update', 'delete']
    nopassuser:
      password: ~
      host: localhost
      databases: []
    application:
      password: 'somepass'
      mine_hosts:
        target: "G@role:database and *.example.com"
        function: "network.get_hostname"
        expr_form: compound
      databases:
        - database: foo
          grants: ['select', 'insert', 'update']
    # some users to remove. user as the mysql.user table point of view.
    alice:
      absent: True
      # you may keep existing parmeters for your history
      password_hash: '*6C8989366EAF75BB670AD8EA7A7FC1176A95CEF4'
      host: localhost
      databases:
        - database: foo
    # the following user was allowed to connect from many host
    # some are removed
    sylvain:
      password: 'echo some | more'
      hosts:
        - localhost
        - 10.0.0.22
      # will add/tested for present on the hosts: above and removed from hosts_absent:
      hosts_absent:
        - 10.0.0.3
      databases:
        - database: foo

  ## Override any names defined in mysql/defaults.yaml
  #lookup:
  #  server: mysql-server
  #  client: mysql-client
  #  service: mysql-service
  #  python: python-mysqldb

  # alternative for mariaDB: tested on debian Jessie it becomes
  lookup:
    # those two are debian packgage's name
    server: mariadb-server
    client: mariadb-client
    # /!\ debconf_package is different from lookup.server
    debconf_package: mariadb-server-10.0
    debconf: mysql-server
    service: mysql
    python: python-mysqldb

  # Install MySQL headers
  dev:
    # Install dev package - defaults to False
    install: False

